# ğŸ“„ äº§å“éœ€æ±‚æ–‡æ¡£è¡¥å……ï¼ˆPRD Supplementï¼‰- ç®€åŒ–ç‰ˆ

**é¡¹ç›®åç§°**ï¼šAI Newsletter Generator - Simple Web Interface  
**ä½œè€…**ï¼šLiz  
**æ—¥æœŸ**ï¼š2025-01-27  
**ç‰ˆæœ¬**ï¼šv2.0-simple  
**åŸºäº**ï¼šåŸå§‹PRD v1.0

---

## 1. è¡¥å……èƒŒæ™¯ä¸ç›®æ ‡

åŸºäºç°æœ‰çš„CLIç‰ˆæœ¬newsletterç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¹é€ ä¸ºä¸€ä¸ª**ç®€å•çš„Webåº”ç”¨**ï¼Œæ”¯æŒå‰ç«¯ç”¨æˆ·é€šè¿‡Webç•Œé¢è¿›è¡Œäº¤äº’ã€‚ä¸»è¦ç›®æ ‡æ˜¯ï¼š

- å°†ç°æœ‰Pythonå·¥ä½œæµå°è£…ä¸ºRESTful APIæœåŠ¡
- æä¾›ç®€å•çš„HTMLå‰ç«¯ç•Œé¢ï¼Œæ”¯æŒç”¨æˆ·ä¸Šä¼ URLåˆ—è¡¨æˆ–ç²˜è´´URLæ–‡æœ¬
- ä¿æŒåŸæœ‰çš„Markdownè¾“å‡ºæ ¼å¼å’Œè´¨é‡
- æ”¯æŒå¼‚æ­¥å¤„ç†å’Œå®æ—¶çŠ¶æ€æ›´æ–°
- ä½¿ç”¨Renderè¿›è¡Œéƒ¨ç½²ï¼Œæ— éœ€Docker

---

## 2. æ–°å¢ç”¨æˆ·åœºæ™¯

### 2.1 Webç”¨æˆ·åœºæ™¯
- **ç ”ç©¶äººå‘˜**ï¼šé€šè¿‡Webç•Œé¢å¿«é€Ÿä¸Šä¼ è®ºæ–‡URLåˆ—è¡¨ï¼Œè·å–åˆ†ç±»æ•´ç†çš„ç ”ç©¶åŠ¨æ€
- **äº§å“ç»ç†**ï¼šæ‰¹é‡å¤„ç†è¡Œä¸šæ–°é—»å’Œäº§å“å‘å¸ƒé“¾æ¥ï¼Œç”Ÿæˆå®šæœŸæŠ¥å‘Š
- **ç¤¾åŒºè¿è¥**ï¼šåœ¨çº¿åˆ›å»ºnewsletterï¼Œæ”¯æŒå®æ—¶é¢„è§ˆå’Œä¸‹è½½

---

## 3. æ–°å¢åŠŸèƒ½éœ€æ±‚

### 3.1 APIæœåŠ¡æ¶æ„

#### 3.1.1 æ ¸å¿ƒAPIç«¯ç‚¹
```
POST /api/v1/newsletter/generate
- è¾“å…¥ï¼šURLåˆ—è¡¨ï¼ˆJSONæ ¼å¼ï¼‰
- è¾“å‡ºï¼šä»»åŠ¡IDå’ŒçŠ¶æ€

GET /api/v1/newsletter/status/{task_id}
- è¾“å‡ºï¼šå¤„ç†è¿›åº¦å’ŒçŠ¶æ€

GET /api/v1/newsletter/result/{task_id}
- è¾“å‡ºï¼šç”Ÿæˆçš„Markdownå†…å®¹

POST /api/v1/newsletter/upload
- è¾“å…¥ï¼šTXTæ–‡ä»¶ä¸Šä¼ 
- è¾“å‡ºï¼šè§£æåçš„URLåˆ—è¡¨

GET /
- è¾“å‡ºï¼šé™æ€HTMLé¡µé¢
```

#### 3.1.2 è¯·æ±‚/å“åº”æ ¼å¼
```json
// ç”Ÿæˆè¯·æ±‚
{
  "urls": [
    "https://arxiv.org/abs/2301.12345",
    "https://openai.com/blog/...",
    "https://github.com/..."
  ],
  "options": {
    "include_subtopics": true,
    "max_recommendation_length": 100
  }
}

// çŠ¶æ€å“åº”
{
  "task_id": "uuid-string",
  "status": "processing|completed|failed",
  "progress": {
    "total_urls": 10,
    "processed": 7,
    "failed": 1
  },
  "estimated_completion": "2025-01-27T15:30:00Z"
}

// ç»“æœå“åº”
{
  "task_id": "uuid-string",
  "status": "completed",
  "markdown_content": "# Newsletter\n\n### ğŸ“„ Papers...",
  "metadata": {
    "generated_at": "2025-01-27T15:25:00Z",
    "total_processed": 10,
    "topics": ["Papers", "Blogs", "Open Source"]
  }
}
```

### 3.2 ç®€å•HTMLå‰ç«¯ç•Œé¢

#### 3.2.1 å•é¡µé¢è®¾è®¡
- **å·¦ä¾§é¢æ¿**ï¼šURLè¾“å…¥åŒºåŸŸ
- **å³ä¾§é¢æ¿**ï¼šMarkdowné¢„è§ˆå’Œä¸‹è½½åŒºåŸŸ
- **åº•éƒ¨çŠ¶æ€æ **ï¼šå¤„ç†è¿›åº¦æ˜¾ç¤º

#### 3.2.2 è¾“å…¥æ–¹å¼
1. **æ–‡æœ¬è¾“å…¥**ï¼š
   - å¤§æ–‡æœ¬æ¡†ï¼Œæ”¯æŒå¤šè¡ŒURLç²˜è´´
   - è‡ªåŠ¨æ£€æµ‹å’ŒéªŒè¯URLæ ¼å¼
   - å®æ—¶å»é‡å’Œè®¡æ•°

2. **æ–‡ä»¶ä¸Šä¼ **ï¼š
   - æ”¯æŒTXTæ–‡ä»¶é€‰æ‹©ä¸Šä¼ 
   - æ–‡ä»¶å†…å®¹é¢„è§ˆå’Œç¼–è¾‘
   - æ”¯æŒæœ€å¤§5MBæ–‡ä»¶

#### 3.2.3 è¾“å‡ºå±•ç¤º
- **å®æ—¶é¢„è§ˆ**ï¼šå¤„ç†è¿‡ç¨‹ä¸­æ˜¾ç¤ºå·²å®Œæˆçš„æ¡ç›®
- **Markdownæ¸²æŸ“**ï¼šä½¿ç”¨marked.jsæ¸²æŸ“Markdown
- **ä¸‹è½½åŠŸèƒ½**ï¼šæ”¯æŒMarkdownæ–‡ä»¶ä¸‹è½½

### 3.3 å¼‚æ­¥å¤„ç†æ¶æ„

#### 3.3.1 ä»»åŠ¡é˜Ÿåˆ—
- ä½¿ç”¨Celery + Rediså®ç°å¼‚æ­¥ä»»åŠ¡å¤„ç†
- æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§å’Œé‡è¯•æœºåˆ¶
- ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–å­˜å‚¨

#### 3.3.2 å®æ—¶é€šä¿¡
- Server-Sent Events (SSE) æ¨é€å¤„ç†è¿›åº¦
- æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

---

## 4. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 4.1 åç«¯æŠ€æœ¯æ ˆ
- **Webæ¡†æ¶**ï¼šFastAPIï¼ˆåŸºäºç°æœ‰APIç»“æ„æ‰©å±•ï¼‰
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šCelery + Redis
- **æ•°æ®åº“**ï¼šSQLiteï¼ˆç®€å•å­˜å‚¨ä»»åŠ¡çŠ¶æ€ï¼‰
- **é™æ€æ–‡ä»¶**ï¼šFastAPIé™æ€æ–‡ä»¶æœåŠ¡
- **éƒ¨ç½²**ï¼šRenderï¼ˆæ— éœ€Dockerï¼‰

### 4.2 å‰ç«¯æŠ€æœ¯æ ˆ
- **HTML/CSS/JavaScript**ï¼šåŸç”Ÿå‰ç«¯æŠ€æœ¯
- **Markdownæ¸²æŸ“**ï¼šmarked.js
- **HTTPå®¢æˆ·ç«¯**ï¼šfetch API
- **å®æ—¶é€šä¿¡**ï¼šEventSource (SSE)


---

## 5. å¼€å‘ä»»åŠ¡åˆ†è§£

### 5.1 Phase 1: APIæœåŠ¡æ”¹é€  
- [x] 5.1.1 æ‰©å±•FastAPIåº”ç”¨ï¼Œæ·»åŠ æ–°çš„APIç«¯ç‚¹
- [x] 5.1.2 é›†æˆCeleryä»»åŠ¡é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥å¤„ç†
- [x] 5.1.3 æ·»åŠ ä»»åŠ¡çŠ¶æ€ç®¡ç†å’ŒSQLiteå­˜å‚¨
- [x] 5.1.4 å®ç°SSEå®æ—¶é€šä¿¡
- [x] 5.1.5 æ·»åŠ é™æ€æ–‡ä»¶æœåŠ¡

### 5.2 Phase 2: ç®€å•å‰ç«¯å¼€å‘ 
- [x] 5.2.1 åˆ›å»ºHTMLé¡µé¢å¸ƒå±€ï¼ˆå·¦å³åˆ†æ ï¼‰
- [x] 5.2.2 å®ç°URLè¾“å…¥ç•Œé¢ï¼ˆæ–‡æœ¬+æ–‡ä»¶ä¸Šä¼ ï¼‰
- [x] 5.2.3 å¼€å‘Markdowné¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½
- [x] 5.2.4 æ·»åŠ SSEè¿›åº¦æ˜¾ç¤º
- [x] 5.2.5 ä¼˜åŒ–æ ·å¼å’Œç”¨æˆ·ä½“éªŒ

### 5.3 Phase 3: Renderéƒ¨ç½² 
- [x] 5.3.1 é…ç½®render.yamléƒ¨ç½²æ–‡ä»¶
- [x] 5.3.2 è®¾ç½®ç¯å¢ƒå˜é‡å’ŒRedisæœåŠ¡
- [x] 5.3.3 æµ‹è¯•ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [x] 5.3.4 æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†

## Relevant Files
- `pyproject.toml`ï¼šå£°æ˜ FastAPIã€Celeryã€SSE ç­‰è¿è¡Œä¾èµ–
- `render.yaml`ï¼šRender å¹³å°éƒ¨ç½²é…ç½®ï¼ˆWebã€Workerã€Redisã€æŒä¹…åŒ–ç£ç›˜ï¼‰
- `README.md`ï¼šæ›´æ–°æœ¬åœ°è¿è¡Œã€éƒ¨ç½²å’Œç¯å¢ƒå˜é‡è¯´æ˜
- `src/newsletter/api/app.py`ï¼šFastAPI åº”ç”¨ã€å¥åº·æ£€æŸ¥ã€SSE ç«¯ç‚¹ä¸ä¸Šä¼ é™åˆ¶
- `src/newsletter/api/models.py`ï¼šAPI è¯·æ±‚/å“åº”ä¸ä»»åŠ¡æ•°æ®æ¨¡å‹
- `src/newsletter/api/task_store.py`ï¼šå†…å­˜ä¸ SQLite ä»»åŠ¡å­˜å‚¨å®ç°
- `src/newsletter/api/pipeline_executor.py`ï¼šç®¡é“æ‰§è¡Œå°è£…ï¼Œå¤ç”¨ç°æœ‰å·¥ä½œæµ
- `src/newsletter/api/dependencies.py`ï¼šä¾èµ–æä¾›è€…ï¼ˆä»»åŠ¡å­˜å‚¨ã€æ‰§è¡Œå™¨ã€è°ƒåº¦å™¨ï¼‰
- `src/newsletter/api/task_dispatcher.py`ï¼šCelery è°ƒåº¦é€‚é…å™¨
- `src/newsletter/api/celery_app.py`ï¼šCelery åº”ç”¨åˆå§‹åŒ–ä¸ä»»åŠ¡æ³¨å†Œ
- `src/newsletter/api/celery_tasks.py`ï¼šCelery ä»»åŠ¡å…¥å£
- `src/newsletter/api/service.py`ï¼šä»»åŠ¡æ‰§è¡Œä¸ç»“æœæŒä¹…åŒ–é€»è¾‘
- `src/newsletter/api/progress.py`ï¼šè¿›åº¦è®¡ç®—å·¥å…·
- `src/newsletter/api/static/index.html`ï¼šå•é¡µå‰ç«¯ç•Œé¢
- `src/newsletter/api/static/styles.css`ï¼šç•Œé¢å¸ƒå±€ä¸æ ·å¼
- `src/newsletter/api/static/app.js`ï¼šå®¢æˆ·ç«¯é€»è¾‘ã€SSEã€äº¤äº’å¤„ç†
- `tests/api/test_app.py`ï¼šç«¯åˆ°ç«¯ API ä¸ SSE æµæµ‹è¯•
- `tests/api/test_pipeline_api.py`ï¼šAPI éªŒè¯/é”™è¯¯åˆ†æ”¯æµ‹è¯•
